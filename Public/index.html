<!doctype html>
<html>
<title>Blessing And Curses!</title>

<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/trianglify/0.2.1/trianglify.min.js"></script>
    <script src="/JS/trianglifyBackground.js"></script>


    <script>
        var $messageForm = $('#messageForm');
        var $message = $('#message');
        var $chat = $('#chat');
        var changeColor = false;
        var username = "Ancient"; 
        /*          

		  var socket = io.connect('127.0.0.1', {
			  'port': 8080,
			  'transports': ['websockets']
			});
        */
        document.addEventListener("DOMContentLoaded", function(){
            			 console.log("Dom Loaded");
        console.log('1');

        // Connect to server
        //var io = require('socket.io-client')
        var socket = io();
        //var socket = io.connect('127.0.0.1:8080', {reconnect: true});
        var socket = io.connect('127.0.0.1:8080', {
            reconnect: true
        });
        console.log('2');

        // <!--send  -->
        $messageForm.submit(function (e) {
            e.preventDefault();

            //added so no blank messages are sent
            if ($message.val() == '') {
                return;
            }

            socket.emit('send message',  username + ': ' + $message.val()  );
            $message.val('');
            changeColor = true;
            console.log("Form Submitted ");
        });

        // <!--recieve --> 
        socket.on('new message', function (data) {
            if (changeColor) {
                $chat.append('<div class= "sent">' + data.msg + '</div>');
                $chat.scrollTop($chat.prop("scrollHeight"));
            } else {
                $chat.append('<div class= "well">' + data.msg + '</div>');
            }

            changeColor = false;
            console.log("New Message ");
        });
        // recieve online members
        socket.on('numOnline', function (data) {
            document.getElementById('num_of_users').innerHTML = 'Current Number Of Users: ' + data.msg;

            console.log(" # of onloine users" + data.msg);
        });

        socket.on('disconnect', function () {
            // Do stuff (probably some jQuery)
            window.location.reload();
        });

        socket.emit('createGame', {
            Hero: "Sam"
        });

        console.log('3');
    });
    </script>
</head>

<body>
    <div class="trianglified" id="trianglify-rouge">
        <p>Home Page! </p>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                </div>
                <div class="col-md-8">
                    <div>
                        <h3 id="name"> Global Chat </h3>
                        <h4 id="num_of_users"></h4>
                        <ul class="list-group" id="user"></ul>
                    </div>
                    <div id="chat_container" class="col-md-8">
                        <div class="chat" id="chat"></div>
                    </div>
                </div>
                <form id="messageForm">
                    <div class="form-group">
                        <textarea class="form-control" id="message"></textarea>
                        <div id="button_elements">
                            <button id="send_button" type="submit" class="btn btn-primary">Send</button>
                            <button id="upload_btn" class="btn btn-primary">Send File</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js"></script>

<link rel="stylesheet" type="text/css" href="/css/main.css">
<script src="/JS/trianglifyBackground.js"> </script>
<script>

var game = new Phaser.Game(800, 600, Phaser.AUTO, 'phaser-example', { preload: preload, create: create });

function preload() {

    game.load.bitmapFont('gem', 'assets/fonts/bitmapFonts/gem.png', 'assets/fonts/bitmapFonts/gem.xml');

}

var bpmText;
var text = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quid ergo aliud intellegetur nisi uti ne quae pars naturae neglegatur? Si longus, levis; Ita relinquet duas, de quibus etiam atque etiam consideret. Optime, inquam. Sed quanta sit alias, nunc tantum possitne esse tanta.\n\nQuid, si etiam iucunda memoria est praeteritorum malorum? Consequatur summas voluptates non modo parvo, sed per me nihilo, si potest; Atque his de rebus et splendida est eorum et illustris oratio. Mihi enim satis est, ipsis non satis. Ergo ita: non posse honeste vivi, nisi honeste vivatur? Mihi quidem Antiochum, quem audis, satis belle videris attendere. Et quod est munus, quod opus sapientiae? Ex rebus enim timiditas, non ex vocabulis nascitur. Ex ea difficultate illae fallaciloquae, ut ait Accius, malitiae natae sunt. Nonne videmus quanta perturbatio rerum omnium consequatur, quanta confusio? Quae cum magnifice primo dici viderentur, considerata minus probabantur.\n\n---> Click to remove text";

function create() {

    game.stage.backgroundColor = 0x272822;

    bmpText = game.add.bitmapText(32, 32, 'gem', text, 16);

    bmpText.maxWidth = 400;

    //  Click to remove text and purge glyphs
    game.input.onDown.addOnce(chopText, this);

}

function chopText() {

    bmpText.text = text.substr(0, 26);

    var purged = bmpText.purgeGlyphs();

    game.add.bitmapText(32, 128, 'gem', "Purged " + purged + " glyphs", 32);

}




    //--------------------- trianglify light blue  ------------------
    function addTriangle(id, couleurX, couleurY) {
        target = document.getElementById(id, couleurX, couleurY);
        if (target != null) {
            var dimensions = target.getClientRects()[0];
            var pattern = Trianglify({
                width: dimensions.width,
                height: dimensions.height,
                x_colors: couleurX,
                y_colors: couleurY,
                cell_size: 100 + Math.random() * 200
            });
            target.style['background-image'] = 'url(' + pattern.png() + ')';
        }
    }
    addTriangle('trianglify-lightblue', ['#a5cade', '#b7d5e5', '#d5e6f0', '#006ab4', '#e8f2f7', '#cee2ed'], ['#cee2ed',
        '#a5cade', '#e8f2f7', '#006ab4', '#d5e6f0', '#b7d5e5'
    ]);
    addTriangle('trianglify-blue', ['#004e83', '#005f9f', '#004879', '#006ab4', '#004777', '#005f9f'],
        ['#005f9f', '#004777', '#006ab4', '#004879', '#005f9f', '#004e83']);
    addTriangle('trianglify-violet', ['#680036', '#830447', '#e62f8e', '#c76c9b'], ['#680036', '#830447', '#e62f8e',
        '#c76c9b'
    ]);
    addTriangle('trianglify-rouge', ['#5f0308', '#851117', '#cf363f', '#e86d74'], ['#5f0308', '#851117', '#cf363f',
        '#e86d74'
    ]);
</script>

</html>